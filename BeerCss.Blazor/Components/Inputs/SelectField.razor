@typeparam TValue
@using Microsoft.AspNetCore.Components.Forms
@using System.Diagnostics.CodeAnalysis
@using BeerCss.Blazor.Common

@inherits Microsoft.AspNetCore.Components.Forms.InputSelect<TValue>

@code {
    [Parameter]
    public bool Fill { get; set; }

    [Parameter]
    public bool Round { get; set; }

    [Parameter]
    public bool Border { get; set; }

    [Parameter]
    public Size Size { get; set; } = Size.Medium;

    [Parameter]
    public string? Label { get; set; }

    [Parameter]
    public string? HelpText { get; set; }

    [Parameter]
    public bool InProgress { get; set; }

    [Parameter]
    public RenderFragment? Prefix { get; set; }

    [Parameter]
    public RenderFragment? Suffix { get; set; }

    private CssBuilder RealCssClass => new CssBuilder()
    .AddClass("field")
    .AddClass(CssClass)
    .AddClass("fill", Fill)
    .AddClass("round", Round)
    .AddClass("border", Border)
    .AddClass("prefix", Prefix is not null || InProgress)
    .AddClass("suffix", Suffix is not null)
    .AddClass("label", Label is not null)
    .AddClass(Size.ToCssClass())
    .AddClassFromAttributes(AdditionalAttributes);

    private RenderFragment RenderInput() => (builder) => base.BuildRenderTree(builder);
}

<div class="@RealCssClass">
    @RenderInput()
    @if (Label is not null)
    {
        <label>@Label</label>
    }
    @if (InProgress)
    {
        <Progress Circle />
    }
    else if (Suffix is not null)
    {
        @Suffix
    }
    else
    {
        <i>arrow_drop_down</i>
    }
    @if (!EditContext.IsValid(this.FieldIdentifier))
    {
        <output class="invalid">@EditContext.GetValidationMessages(this.FieldIdentifier).FirstOrDefault()</output>
    }
    else if (HelpText is not null)
    {
        <output>@HelpText</output>
    }
</div>